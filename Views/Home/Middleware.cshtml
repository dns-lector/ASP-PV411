@{
    ViewData["Title"] = "Middleware";
}

<div class="text-center">
    <h1 class="display-4">Middleware. Утримання авторизації</h1>
</div>

<img src="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/middleware/index/_static/request-delegate-pipeline.png?view=aspnetcore-10.0"
     alt="Middleware" />
<p>
    Middleware - архітектура програмного забезпечення за якої формуються окремі модулі 
    програми, які передають управління один до іншого. Характерною особливістю 
    є те, що нові модулі можуть додаватись в середину наявного ланцюга модулів, за що 
    архітектура і дістала назву Middleware
</p>
<p>
    Для задач веб-проєктів модулі Middleware складються з двох частин, розділених 
    командою передачі управління наступному модулю <code>next()</code>. Те, що 
    виконується до команди - "прямий" хід, який зазвичай аналізує запит (request). 
    Після команди - зворотній хід, у якому зазвичай формується відповідь (response).
    Наприклад, модуль архівації: на прямому ході розархівує запит (або його тіло), 
    а на зворотньому - архівує.
</p>
<h2>Авторизація на основі сесій</h2>
<p>
    Сесії (сеанси) здатні зберігати дані для конкретного клієнта, що дозволяє 
    закласти в сесію дані про вхід (автентифікацію). Для практичного використання 
    необхідно: 
</p>
<ul>
	<li>підібрати належний час "життя" сеансів (Program.cs, конфігурація сервісу сесії)</li>
    <li>за фактом успішної автентифікації зберегти у сесії відповідні дані: або
        ідентифікатор користувача, або увесь серіалізований об'єкт 
        (див. UserController::Authenticate)
    </li>
    <li>створити Middleware, реалізувати перевірку наявності у сесії збережених даних,
        за наявності - відновити дані з сесії та перекласти до контексту HTTP
    </li>
	<li>(варіант 1, не рекомендований) - використати контейнер <code>context.Items</code></li>
    <li></li>
    <li>у місцях, де вимагається інформація про автентифікацію, необхідно вилучити 
        з контексту відповідні дані (див, наприклад, _Layout).
    </li>
</ul>